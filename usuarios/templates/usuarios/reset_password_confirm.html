{% extends 'usuarios/base.html' %}
{% block title %}Nueva Contrase√±a{% endblock %}

{% block content %}
<div class="panel-container">

    <h2>Crear nueva contrase√±a</h2>

    {% for message in messages %}
        <p class="msg {{ message.tags }}">{{ message }}</p>
    {% endfor %}

    <form method="POST" onsubmit="return validarPassword()">
        {% csrf_token %}

        <label for="password">Nueva contrase√±a</label>
        <small style="display:block; margin-bottom:6px; color:#555;">
            Debe incluir may√∫sculas, min√∫sculas, n√∫meros y caracteres especiales.
        </small>

        <div style="position: relative;">
            <input 
                type="password" 
                id="password" 
                name="password" 
                required 
                placeholder="Ej: Abc123@!" 
                style="padding-right: 42px;"
            >

            <span 
                onclick="togglePassword()" 
                style="
                    position: absolute;
                    right: 10px;
                    top: 50%;
                    transform: translateY(-50%);
                    cursor: pointer;
                    font-size: 18px;
                    color: #555;
                ">
                üëÅ
            </span>
        </div>

        <p id="error-msg" style="color:red; margin-top:8px; display:none;">
            La contrase√±a no cumple los requisitos.
        </p>

        <button type="submit" class="btn-blue" style="margin-top: 15px;">
            Guardar
        </button>
    </form>

</div>

<script>
function togglePassword() {
    const p = document.getElementById("password");
    p.type = p.type === "password" ? "text" : "password";
}

function validarPassword() {
    const p = document.getElementById("password").value;
    const error = document.getElementById("error-msg");

    const regex = /^(?=.[a-z])(?=.[A-Z])(?=.\d)(?=.[\W_]).+$/;

    if (!regex.test(p)) {
        error.style.display = "block";
        return false; // evita enviar el formulario
    }

    error.style.display = "none";
    return true;
}
</script>

{% endblock %}

